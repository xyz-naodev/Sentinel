<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Settings - Sentinel</title>
	<link rel="stylesheet" href="../css/style.css">
	<link rel="stylesheet" href="../css/dashboard.css">
	<link rel="stylesheet" href="../css/settings.css">
	<link rel="stylesheet" href="../css/loading.css">
	<link rel="stylesheet" href="../css/notification.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

	<!-- Firebase SDK -->
	<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database.js"></script>
	<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth.js"></script>

	<!-- Firebase Web Service & Auth -->
	<script src="../js/firebase-web-service.js"></script>
	<script src="../js/firebase-auth-service.js"></script>
	<script src="../js/page-auth-guard.js"></script>
</head>
<body>
	<div class="dashboard-container">
		<aside class="sidebar">
			<div class="sidebar-header">
				<img src="../img/Dashboard-logo.png" alt="Sentinel Logo" class="sidebar-logo-img">
			</div>

			<div class="sidebar-user">
				<div class="user-avatar">
					<i class="fa-solid fa-user"></i>
				</div>
				<div class="user-info">
					<h4>ADMIN</h4>
					<p>Online</p>
				</div>
			</div>

			<ul class="sidebar-nav">
				<li><a href="dashboard.html"><i class="fa-solid fa-table-columns"></i> Dashboard</a></li>
				<li><a href="incireport.html"><i class="fa-solid fa-clipboard-list"></i> Incident Reports</a></li>
				<li><a href="analytics.html"><i class="fa-solid fa-chart-simple"></i> Analytics</a></li>
				<li><a href="settings.html" class="active"><i class="fa-solid fa-gear"></i> Settings</a></li>
			</ul>

			<div class="sidebar-logout">
				<button id="logoutBtn" class="btn btn-secondary">
					<i class="fa-solid fa-right-from-bracket"></i> Sign Out
				</button>
			</div>
		</aside>

		<main class="main-content">
			<div class="top-bar">
				<div class="top-bar-left">
					<input type="text" class="top-bar-search" placeholder="Search...">
				</div>
				<div class="top-bar-right">
					<div style="position: relative; display: inline-block;">
						<i class="top-bar-icon fa-solid fa-bell" id="notificationBell" style="cursor: pointer; font-size: 18px; transition: transform 0.2s;" title="Notifications"></i>
						<span id="notificationBadge" style="position: absolute; top: -8px; right: -8px; background: #B00020; color: white; border-radius: 50%; width: 24px; height: 24px; display: none; align-items: center; justify-content: center; font-size: 12px; font-weight: 600;"></span>
						
						<!-- Notification Panel -->
						<div id="notificationPanel" style="position: absolute; top: 40px; right: 0; background: white; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 4px 16px rgba(0,0,0,0.15); width: 380px; max-height: 500px; display: none; z-index: 1000; flex-direction: column; overflow: hidden; pointer-events: none;">
							<div style="padding: 14px 16px; border-bottom: 1px solid #eee; background: #f9f9f9; display: flex; justify-content: space-between; align-items: center;">
								<h3 style="margin: 0; font-size: 15px; color: #333; font-weight: 600;">Notifications</h3>
								<button id="clearAllNotifications" style="background: none; border: none; color: #999; cursor: pointer; font-size: 13px; padding: 4px 8px; transition: color 0.2s;" title="Clear all">Clear All</button>
							</div>
							<div id="notificationPanelContent" style="overflow-y: auto; flex: 1;">
								<div style="padding: 20px; text-align: center; color: #999;">Loading...</div>
							</div>
						</div>
					</div>
					
					<i class="top-bar-icon fa-solid fa-circle-info" id="filterInfoIcon" style="cursor: pointer;"></i>
					<div class="admin-section">
						<span>ADMIN</span>
						<div class="admin-avatar">
							<i class="fa-solid fa-user"></i>
						</div>
					</div>
				</div>
			</div>

			<div class="page-content">
				<div class="page-header" style="display: flex; justify-content: space-between; align-items: flex-start;">
					<div>
						<h1>Settings</h1>
						<p class="page-timestamp">As of <span id="as-of-time">10:59 PM</span> <i class="fa-solid fa-rotate-right"></i></p>
					</div>
					<button id="saveSettingsBtn" class="btn btn-primary" style="margin-top: 5px;">Save Changes</button>
				</div>

				<!-- Two Column Layout -->
				<div class="settings-layout">
					<!-- LEFT COLUMN: NAVIGATION TABS (30%) -->
					<div class="settings-left">
						<div class="card" style="height: fit-content;">
							<div class="settings-nav-tabs">
								<button class="tab active" data-target="account" style="display: flex; align-items: center; gap: 12px;">
									<i class="fa-solid fa-user" style="width: 20px; text-align: center;"></i> <span>Account Settings</span>
								</button>
								<button class="tab" data-target="activity" style="display: flex; align-items: center; gap: 12px;">
									<i class="fa-solid fa-lock" style="width: 20px; text-align: center;"></i> <span>Activity Logs</span>
								</button>
							<button class="tab" data-target="about" style="display: flex; align-items: center; gap: 12px;">
								<i class="fa-solid fa-laptop" style="width: 20px; text-align: center;"></i> <span>About System</span>
							</button>

							</div>
						</div>
					</div>

					<!-- RIGHT COLUMN: SETTINGS CONTENT (70%) -->
					<div class="settings-right">
						<!-- ACCOUNT SETTINGS TAB -->
						<div class="card panel" id="account">
							<h3><i class="fa-solid fa-user"></i> Account Settings</h3>
							<div style="display: flex; flex-direction: column; gap: 20px; margin-top: 20px;">
								<div>
									<label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">Username</label>
									<input type="text" value="admin" readonly style="width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 8px; background: #f9f9f9;">
								</div>

								<div>
									<label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">Name</label>
									<input type="text" id="settingsName" value="Administrator" style="width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
								</div>

								<div>
									<label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">Email</label>
									<input type="email" id="settingsEmail" placeholder="admin@sentinel.local" style="width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
								</div>

								<div>
									<label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">Phone</label>
									<input type="tel" id="settingsPhone" placeholder="+63 9XX XXXX XXX" style="width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
								</div>

								<div>
									<label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">Department</label>
									<input type="text" id="settingsDepartment" placeholder="e.g., Barangay Police" style="width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
								</div>

								<div>
									<label style="display: block; margin-bottom: 12px; font-weight: 600; font-size: 14px;">Notification Preferences</label>
									<div style="display: flex; flex-direction: column; gap: 12px;">
										<label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
											<input type="checkbox" id="notifEmail" style="width: 18px; height: 18px; cursor: pointer;">
											<span style="font-size: 14px; color: #333;">Email Alerts</span>
										</label>
										<label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
											<input type="checkbox" id="notifSMS" style="width: 18px; height: 18px; cursor: pointer;">
											<span style="font-size: 14px; color: #333;">SMS Alerts</span>
										</label>
										<label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
											<input type="checkbox" id="notifPush" checked style="width: 18px; height: 18px; cursor: pointer;">
											<span style="font-size: 14px; color: #333;">Push Notifications</span>
										</label>
									</div>
								</div>

								<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
									<button class="btn btn-outline" style="text-align: center; width: 100%; display: flex; align-items: center; justify-content: center;">Change Password</button>
									<button class="btn btn-outline" style="text-align: center; width: 100%; display: flex; align-items: center; justify-content: center;">Login Activity</button>
								</div>
							</div>
						</div>

						<!-- ACTIVITY LOGS TAB -->
						<div class="card panel hidden" id="activity">
							<h3><i class="fa-solid fa-list"></i> Activity Logs</h3>
							<div id="settingsActivityLogContainer" style="min-height: 300px; max-height: 500px; overflow-y: auto; padding: 15px 0; border: 1px solid #e0e0e0; border-radius: 8px; margin-top: 15px;">
								<div style="text-align: center; color: #999; padding: 40px;">
									<i class="fa-solid fa-spinner" style="font-size: 28px; margin-bottom: 10px; display: block; animation: spin 2s linear infinite;"></i>
									Loading activity logs...
								</div>
							</div>
						</div>

						<!-- ABOUT SYSTEM TAB -->
						<div class="card panel hidden" id="about">
							<h3><i class="fa-solid fa-laptop"></i> About System</h3>
							
							<!-- System Version -->
							<div style="padding: 20px; margin-bottom: 30px; background: #f9f9f9; border-radius: 8px; border-left: 4px solid var(--primary-red);">
								<div style="font-weight: 600; color: #333; margin-bottom: 8px;">System Version</div>
								<div style="font-size: 24px; font-weight: bold; color: var(--primary-red);">1.0.0.0</div>
								<div style="font-size: 12px; color: #999; margin-top: 8px;">SENTINEL Tanod Response System</div>
							</div>

							<!-- Development Team -->
							<div style="margin-bottom: 15px;">
								<h4 style="color: #333; margin-bottom: 15px; font-size: 16px;">Development Team</h4>
								<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
									
									<!-- Developer Card 1 -->
									<div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; text-align: center; transition: all 0.3s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
										<div style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--primary-red), #d32f2f); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; box-shadow: 0 4px 8px rgba(211, 47, 47, 0.2);">
											<i class="fa-solid fa-user" style="font-size: 28px; color: white;"></i>
										</div>
										<div style="font-weight: 600; color: #333; margin-bottom: 4px; font-size: 14px;">Lady Jade L. Cambronero</div>
										<div style="font-size: 12px; color: #999; word-break: break-word;">cc.ladyjade.cambronero@cvsu.edu.ph</div>
									</div>

									<!-- Developer Card 2 -->
									<div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; text-align: center; transition: all 0.3s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
										<div style="width: 60px; height: 60px; background: linear-gradient(135deg, #FF9800, #F57C00); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; box-shadow: 0 4px 8px rgba(255, 152, 0, 0.2);">
											<i class="fa-solid fa-user" style="font-size: 28px; color: white;"></i>
										</div>
										<div style="font-weight: 600; color: #333; margin-bottom: 4px; font-size: 14px;">Glaizela Jane D. Gagarin</div>
										<div style="font-size: 12px; color: #999; word-break: break-word;">cc.glaizelajane.gagarin@cvsu.edu.ph</div>
									</div>

									<!-- Developer Card 3 -->
									<div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; text-align: center; transition: all 0.3s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
										<div style="width: 60px; height: 60px; background: linear-gradient(135deg, #2196F3, #1976D2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; box-shadow: 0 4px 8px rgba(33, 150, 243, 0.2);">
											<i class="fa-solid fa-user" style="font-size: 28px; color: white;"></i>
										</div>
										<div style="font-weight: 600; color: #333; margin-bottom: 4px; font-size: 14px;">Mark Angelo A. Lamagan</div>
										<div style="font-size: 12px; color: #999; word-break: break-word;">cc.markangelo.lamagan@cvsu.edu.ph</div>
									</div>

									<!-- Developer Card 4 -->
									<div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; text-align: center; transition: all 0.3s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
										<div style="width: 60px; height: 60px; background: linear-gradient(135deg, #4CAF50, #388E3C); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; box-shadow: 0 4px 8px rgba(76, 175, 80, 0.2);">
											<i class="fa-solid fa-user" style="font-size: 28px; color: white;"></i>
										</div>
										<div style="font-weight: 600; color: #333; margin-bottom: 4px; font-size: 14px;">John Benedict L. Tabor</div>
										<div style="font-size: 12px; color: #999; word-break: break-word;">cc.johnbenedict.tabor@cvsu.edu.ph</div>
									</div>

								</div>
							</div>
						</div>

						<!-- PI GPS CONFIGURATION TAB - REMOVED (Flutter app handles this) -->
				</div>
			</div>
		</main>
	</div>

	<script src="../js/utils.js"></script>

	<!-- ACCESSIBILITY ENHANCEMENTS (ARIA labels, keyboard nav, color contrast) -->
	<script src="../js/accessibility-enhancements.js"></script>

	<!-- NOTIFICATION MANAGER -->
	<script src="../js/notification-manager.js"></script>

	<!-- NOTIFICATION SYSTEM -->
	<script src="../js/notification-system.js"></script>
	<script src="../js/asof-clock.js"></script>
	
	<!-- FIREBASE INITIALIZATION - Load synchronously -->
	<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js"></script>
	<script src="../js/firebase-web-service.js"></script>
	
	<!-- Initialize Notification Manager with Firebase -->
	<script>
		// Hook notification manager to Firebase incidents
		if (typeof firebaseService !== 'undefined' && window.notificationManager) {
			// Listen to incidents updates
			firebaseService.onIncidentsChange((incidents) => {
				if (incidents && incidents.length > 0) {
					window.notificationManager.checkForNewIncidents(incidents);
				}
			});
			
			// Initial load
			if (firebaseService.incidents && firebaseService.incidents.length > 0) {
				window.notificationManager.checkForNewIncidents(firebaseService.incidents);
			}
		}
	</script>
	
	<!-- Settings page script - Load after Firebase -->
	<script src="../js/settings.js" defer></script>

	<!-- Settings page initialization with error handling -->
	<script>
		document.addEventListener('DOMContentLoaded', () => {
			try {
				Logger.info('Settings page initialization started');

				// Setup logout functionality
				const signoutBtn = document.getElementById('logoutBtn');
			if (signoutBtn) {
				signoutBtn.addEventListener('click', (e) => {
					e.preventDefault();
					try {
						Logger.info('User initiated logout from settings');
						// Clear all authentication data
						if (typeof StorageHelper !== 'undefined') {
							StorageHelper.remove('sentinel_logged_in');
						} else {
							localStorage.removeItem('sentinel_logged_in');
							sessionStorage.clear();
						}
						// Redirect to login page
						window.location.href = './login.html';
					} catch (error) {
						Logger.error('Logout error', error.message);
						console.error('Logout failed:', error);
						// Force redirect to login
						window.location.href = './login.html';
					}
				});
			} else {
				Logger.warn('Logout button not found');
			}				Logger.info('Settings page initialization completed');

			} catch (error) {
				Logger.error('Critical error during settings initialization', error.message);
				console.error('Settings init error:', error);
			}
		});

		/**
		 * Notification UI is handled by shared-notification-ui.js
		 */

		// Initial update
		updateNotificationUI();

		/**
		 * Filter Info Icon Click Handler - Settings
		 */
		const filterInfoIcon = document.getElementById('filterInfoIcon');
		if (filterInfoIcon) {
			filterInfoIcon.addEventListener('click', () => {
				const modal = document.createElement('div');
				modal.style.cssText = `
					position: fixed; top: 0; left: 0; width: 100%; height: 100%;
					background: rgba(0, 0, 0, 0.5); display: flex;
					justify-content: center; align-items: center; z-index: 10000;
					animation: fadeIn 0.3s ease;
				`;

				const modalContent = document.createElement('div');
				modalContent.style.cssText = `
					background: white; border-radius: 12px; padding: 30px;
					max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;
					box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
					animation: slideUp 0.3s ease;
				`;

				modalContent.innerHTML = `
					<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
						<h2 style="margin: 0; color: #333; font-size: 22px;">
							<i class="fa-solid fa-gear" style="color: #B00020; margin-right: 10px;"></i>
							Settings
						</h2>
						<button id="closeModal" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">
							<i class="fa-solid fa-times"></i>
						</button>
					</div>

					<div style="color: #666; line-height: 1.8;">
						<p><strong>Customize your dashboard experience and account preferences.</strong></p>

						<div style="margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 8px; border-left: 4px solid #B00020;">
							<h3 style="margin: 0 0 10px 0; color: #333;">Account Settings</h3>
							<p style="margin: 0;">Manage your profile information:</p>
							<ul style="margin: 8px 0 0 0; padding-left: 20px;">
								<li>Update username and profile details</li>
								<li>Change password securely</li>
								<li>Enable two-factor authentication</li>
							</ul>
						</div>

						<div style="margin-top: 15px; padding: 15px; background: #f5f5f5; border-radius: 8px; border-left: 4px solid #B00020;">
							<h3 style="margin: 0 0 10px 0; color: #333;">Activity Logs</h3>
							<p style="margin: 0;">View your account activity history including:</p>
							<ul style="margin: 8px 0 0 0; padding-left: 20px;">
								<li>Login history and timestamps</li>
								<li>Recent actions and changes</li>
								<li>Security events</li>
							</ul>
						</div>

						<div style="margin-top: 15px; padding: 15px; background: #f5f5f5; border-radius: 8px; border-left: 4px solid #B00020;">
							<h3 style="margin: 0 0 10px 0; color: #333;">Preferences</h3>
							<p style="margin: 0;">Customize your experience:</p>
							<ul style="margin: 8px 0 0 0; padding-left: 20px;">
								<li>Theme and display preferences</li>
								<li>Notification settings</li>
								<li>Language and timezone</li>
								<li>Privacy and visibility options</li>
							</ul>
						</div>

						<div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
							<p style="margin: 0;"><strong>ðŸ’¡ Tip:</strong> Don't forget to click "Save Changes" after modifying your settings to apply them.</p>
						</div>
					</div>

					<div style="margin-top: 25px; display: flex; justify-content: flex-end; gap: 10px;">
						<button id="closeModalBtn" style="background: white; border: 2px solid #B00020; color: #B00020; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.2s;">Close</button>
					</div>
				`;

				modal.appendChild(modalContent);
				document.body.appendChild(modal);

				const closeButton = document.getElementById('closeModal');
				const closeButtonBtn = document.getElementById('closeModalBtn');
				
				const closeModal = () => {
					modal.style.animation = 'fadeOut 0.3s ease';
					setTimeout(() => modal.remove(), 300);
				};

				closeButton.addEventListener('click', closeModal);
				closeButtonBtn.addEventListener('click', closeModal);
				modal.addEventListener('click', (e) => {
					if (e.target === modal) closeModal();
				});

				const escapeHandler = (e) => {
					if (e.key === 'Escape') {
						closeModal();
						document.removeEventListener('keydown', escapeHandler);
					}
				};
				document.addEventListener('keydown', escapeHandler);
			});
		}
	</script>

</body>
</html>
